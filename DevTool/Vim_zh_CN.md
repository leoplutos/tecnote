# Vim

## Vim简介
Vim是一个类似于Vi的著名的功能强大、高度可定制的文本编辑器，在Vi的基础上改进和增加了很多特性。代码补全、编译及错误跳转等方便编程的功能特别丰富，在程序员中被广泛使用。  
众多 Linux 发行版系统，通常都已经默认安装好了 vi 或 Vim 文本编辑器，所以在终端开发应用很多。  
学习Vim还有下面2个网址：  
https://www.openvim.com/  
https://vim-adventures.com/  

## 基础操作：打开文件/路径

打开1个文件
```bash
vim file1
```

打开当前路径(使用Netrw文件浏览器)
```bash
vim .
```

打开两个文件 file1，file2
```bash
vim file1 file2
```

指定配置文件打开afile.txt
```bash
vim -u /lch/workspace/vim/lchvimrc afile.txt
```

不使用任何配置文件打开afile.txt
```bash
vim -u NONE afile.txt
```

如果你实在不想每次都敲那么多东西，可以用alias键映射：
```bash
alias vim='vim -u /lch/workspace/vim/lchvimrc'
```
## VIM 常用的有四个模式：

* **正常模式 (Normal-mode)**
* **编辑模式 (Insert-mode)**
* **命令模式 (Command-mode)**
* **可视模式 (Visual-mode)**

进入vim就是正常模式  
ESC 回到正常模式  
i,a,o 进入编辑模式  
:或者/ 进入命令模式  
v, V, Ctrl+v 进入内容选择模式  

使用熟练之后，其实只有两个模式，便于理解（纯个人见解，用熟 VIM 以后，应该会赞同这个理解）：
* **操作模式**
* **编辑模式**

## 入门命令
先只看下面的入门命令，理解了之后再继续看（不然会劝退）

h ←  
j ↓  
k ↑  
l →  

w 到下一个单词的第一个字母  
b 到上一个单词的第一个字母  
e 到当前单词的最后一个字母  

在阅览模式下输入  
30i- ESC  ：会插入30个-线  
10iALL ESC  ：会插入10个ALL

% 匹配括号移动，包括 ( , { , [ 需要把光标先移动到括号上  

0 到行头   
$ 到行尾  
H 光标定位到当前屏幕的第一行行首  
M 光标移动到当前屏幕的中间  
L 光标移动到当前屏幕的尾部  

ctrl+f 查看下一页内容  
ctrl+b 查看上一页内容  

\* 以当前光标所在处的单词为查找对象，跳到下一个  
\# 以当前光标所在处的单词为查找对象，跳到上一个

gg 到文件最开始  
G 到文件最后  

25G 到第25行  

/abc回车 查找abc  
查找之后：n为下一条，N为上一条

o 在当前行下面插入新行，并进入编辑模式  
O 在当前行上面插入新行，并进入编辑模式  

x 删除当前字符  

r 替换当前光标所在处的字符  
re 替换r为e  

dw 剪切到下一个单词的第一个字母  
d2w 剪切到下两个单词的第一个字母  
dd 剪切当前行  
yy 复制当前行  
p 粘贴  

gt 移动的下一个tab  
gT 移动的上一个tab  

:wq 保存  
:q 退出  
:q! 不保存并退出  
:qa! 不保存所有并退出

##  进阶命令：打开文件，分割窗口，保存文件

这个命令将会列出 VIM 打开的所有文件。  
```
:ls
```

这个命令将会在显示屏上显示第二个文件。  
```
:b2
```

**这个命令将会左右分割当前的文件** 
```
Ctrl +w v
```

**将当前光标定位到左边的屏幕**  
```
Ctrl + w h
```

**将当前的光标定位到右边的屏幕**  
```
Ctrl + w l
```

**这个命令是关闭当前的分屏**  
```
Ctrl + w c
```
 
将当前的光标移动到下面的分屏  
```
Ctrl + w j 
```

将当前光标移动到上面的分屏  
```
Ctrl + w k  
```

保存当前对文件的修改，但是不退出文件。 
```
:w
```

强制保存但是不退出文件。  
```
:w!
```

保存当前的文件修改到 file 文件当中。 
```
:w file
```

退出文件，对文件的修改不做保存。  
```
:q!
```

退出所有的文件，对所有的文件修改都不做保存。
```
:qa!
```

退出文件并保存对文件的修改。  
```
:wq
```

退出文件并保存对文件的修改。 
```
:x
```

打开另一个文件。  
```
:e file
```

放弃对文件的所有修改，恢复文件到上次保存的位置。  
```
:e!
```

另存为 file。  
```
:saveas file
```

当打开多个文件的时候可以输入 :bn 和 :bp 进行上一个文件或者下一个文件的切换。  
```
:bn  
:bp
```

## 进阶命令：编辑文本

i 是在光标所在的字符之前插入需要录入的文本。  
I 是在光标所在行的行首插入需要录入的文本。  

a 是在光标所在的字符之后插入需要录入的文本。  
A 是在光标所在行的行尾插入需要录入的文本。  

o 是光标所在行的下一行行首插入需要录入的文本。  
O 是光标所在行的上一行行首插入需要录入的文本。  

s 删除光标所在处的字符然后插入需要录入的文本。  
S 删除光标所在行，在当前行的行首开始插入需要录入的文本。  

还有一个可能经常用到的就是 cw ，删除从光标处开始到该单词结束的所有字符，然后插入需要录入的文本（这个命令是两个字符的合体 cw ）。

## 进阶命令：命令模式

关于命令模式上文有提到过，下面主要来列举几个常用的命令模式操作（命令输入完以后，需要按下 Enter 键去执行命令）：  
文本的行号设置最好不要设置在配置文件中（因为复制文件的时候行号的出现会很麻烦），在命令行实现就好。

该命令会显示行号。  
```
:set nu
```

该命令会取消行号。  
```
:set nonu
```

定位到 n 行。  
```
:n
```

**查找目标**
```
/{目标字符串}  
```
如：/zempty 会在文本中匹配 zempty 的地方高亮。  
查找文本中匹配的目标字符串，查到以后，输入键盘上的 n 会去寻找下一个匹配，N 会去寻找上一个匹配。  

**grep目标**
```
:vim {pattern} {file} | cw  
```
例子
```
:vim com_ **/*.c | cw  
```
 

**文本替换**  
```
:{作用范围}s/{目标}/{替换}/{替换的标志}  
```
作用范围分为当前行、全文、选区等等。
```
:s/zempty/handsome/g  
```
将会把当前光标所在行的 zempty 替换成 handsome  
```
:%s/zempty/handsome/g  
```
将会把全文中的 zempty 替换成 handsome
```
:n1,n2s/zempty/handsome/g  
```
这里的 n1 和 n2 值得是行号，将会替换掉 n1 到 n2 的所有 zempty 为 handsome.  

上文中命令结尾的 g 即是替换标志之一，表示全局 global 替换（即替换目标的所有出现）。 还有很多其他有用的替换标志：  
空替换标志表示只替换从光标位置开始，目标的第一次出现  
```
:s/zempty/handsome  
```
作用于当前行，从光标处开始查找替换，仅仅替换第一次匹配 zempty 的地方为handsome 。  
```
:%s/zempty/handsome  
```
替换掉文件中所有行第一次出现 zempty 的地方为 handsome 。  
i 表示大小写不敏感查找，I 表示大小写敏感：  
```
:%s/zempty/handsome/i  
```
替换掉所有行第一个出现 zempty (不区分大小写) 为 handsome 。  
```
:%s/zempty/handsome/gi  
```
替换掉所有行出现 zempty (不区分大小写) 为 handsome 。  
c 表示需要确认，例如全局查找"zempty"替换为"handsome"并且需要确认：
```
:%s/zempty/handsome/gc  
```


## 执行 Linux 命令
```
:!command  
```
: 后面紧跟着 ! ，! 后面紧跟着 linux 命令（ command 指操作 Linux 系统的一系列命令，如创建文件，新建文件夹，查询文件的属性的等），例子如下，
```
:!date
```
执行 date 命令显示时间，执行完命令以后按下键盘上的 Enter 就会返回到文件。  
VIM 执行命令，并且添加结果至操作文本光标处
```
:r !command  
```
: 后面紧跟着 r , r 后面是空格，紧接着是 !command( command 解释同上)，例子如下，  
```
:r !date  
```
执行 date 命令显示时间，并且添加命令结果到文本中。  

## 使用 ab
```
:ab email xxxx@gmail.com  
```
: 后面的 ab 是关键字 ,该命令执行后，然后切换到编辑模式下,输入 email 会把输入的 email 自动替换成 xxxx@gmail.com。  
这个命令主要是处理频繁输入同样的长串字符串。
在当前行上移动光标  
此外还有：
* dib
* dab

## 移动光标

0 移动到行头  
^ 移动到本行的第一个不是 blank 字符  
$ 移动到行尾  
g_ 移动到本行最后一个不是 blank 字符的位置  
w 光标移动到下一个单词的开头  
e 光标移动到下一个单词的结尾  
fa 移动到本行下一个为 a 的字符处，fb 移动到下一个为 b 的字符处  
nfa 移动到本行光标处开始的第 n 个 字符为 a 的地方（n 是 1，2，3，4 ... 数字）  
Fa 同 fa 一样，光标移动方向同 fa 相反  
nFa 同 nfa 类似，光标移动方向同 nfa相反  
ta 移动光标至 a 字符的前一个字符  
nta 移动到第二个 a 字符的前一个字符处  
Ta 同 ta 移动光标方向相反  
nTa 同 nta 移动光标方向相反  
; 和, 当使用 f, F, t ,T, 关键字指定字符跳转的时候，使用 ；可以快速跳转到下一个指定的字符，, 是跳到前一个指定的字符

**跨行移动光标**  
nG 光标定位到第 n 行的行首  
gg 光标定位到第一行的行首  
G 光标定位到最后一行的行首  
**H 光标定位到当前屏幕的第一行行首  
M 光标移动到当前屏幕的中间  
L 光标移动到当前屏幕的尾部  
zt 把当前行移动到当前屏幕的最上方，也就是第一行  
zz 把当前行移动到当前屏幕的中间  
zb 把当前行移动到当前屏幕的尾部**  
% 匹配括号移动，包括 ( , { , [ 需要把光标先移动到括号上  
\* 和 # 匹配光标当前所在的单词，移动光标到下一个（或者上一个）匹配的单词（ * 是下一个，# 是上一个）

## 复制，黏贴 ，删除

三个重要的快捷键 d , y , p

d 是删除的意思，通常搭配一个字符 ( 删除范围 ) 实现删除功能，常用的如下：  
dw 删除一个单词  
dnw 删除 n 个单词  
dfa 删除光标处到下一个 a 的字符处（ fa 定位光标到 a 处 ）  
dnfa 删除光标处到第 n 个 a 的字符处  
dd 删除一整行  
ndd 删除光标处开始的 n 行  
d$ 删除光标到本行的结尾  
dH 删除屏幕显示的第一行文本到光标所在的行  
dG 删除光标所在行到文本的结束  

y 是复制的意思，通常搭配一个字符（复制范围）实现复制的功能，常用的如下：  
yw 复制一个单词，还有 ynw  
yfa 复制光标到下一个 a 的字符处,还有ynfa  
yy 复制一行，还有 nyy  
y$ 复制光标到本号的结尾  
yH 复制屏幕显示的第一行文本到光标所在的行  
yG 复制光标所在行到文本的结束  

p ，P是黏贴的意思，当执行完复制或者黏贴的命令以后，VIM 会把文本寄存起来。  
p 在光标后开始黏贴  
P 大写的 P 光标前开始粘贴  

**撤销操作和恢复**

u 撤销刚才的操作  
ctrl + r 恢复撤销操作

## 删除字符操作和替换

x 删除光标当前所在的字符  
r 替换掉光标当前所在的字符  
R 替换掉从光标开始以后的所有字符，除非 ESC  退出

## 大小写转换

~ 将光标下的字母改变大小写  
3~ 将光标位置开始的3个字母改变其大小写  
g~~ 改变当前行字母的大小写  
gUU 将当前行的字母改成大写  
guu 将当前行的字母全改成小写  

3gUU 将从光标开始到下面3行字母改成大写  
gUw 将光标下的单词改成大写。  
guw 将光标下的单词改成小写  

## 重复命令

. 该命令是重复上一个操作的命令  
n<command>重复某个命令 n 次，
如 10p复制 10 次，10dd 删除十次。

## 可视化模式（Visual-mode)

v,V,Ctrl+v

v字符可视化，按下键盘上的v以后，屏幕底部应该会有一个 VISUAl 的提示，操作 h,j,k,l就选中文本，继续按 v 退出可视化模式。  

V 行可视化，按下键盘上的 V 以后，屏幕底部应该有一个 VISUAL LINE 的提示，操作 j,k 可以向上或者向下以行为单位选中文本，继续按下 V 退出可视化模式。  

Ctrl+v 块状可视化，按下键盘上的 Ctrl+v 以后，屏幕底部应该会有一个提示 VISUALBLOCK ，可以通过 h,j,k,l 块状的操作选择区域，这是很多编辑器都不可以做到的，继续按下 Ctrl+v 会退出可视化模式。

**可视化模式下操作文本**

可视化模式下选择操作区域以后，  
按下 d 会删除选择的区域，  
按下 y 会复制选择的区域，  
按下 p 会黏贴选择的区域。

**可视化模式下 v 的特殊操作**

当操作的文本光标在 “”，‘’ ，（），{} ，[（双引号，单引号，小括号，大括号，中括号）
当中的时候  
va"选中 ”“ 内的所有内容包括双引号  
vi" 选中 "" 内的所有内容，不包括 ""  
va,vi 会快速选择区域，va 后面会紧跟一个区域结束标志，a 会选中结束符标志，i 就不会

**块区域下的特殊操作**  
Ctrl+v 选中块区域以后，按下大写的 I 或者 A 可以在区域的前面或者后面输入内容，按下 ESC,可以看到选中的区域前面或者后面会有输入的内容。

## 代码提示功能

在编辑模式下 ，快捷键 Ctrl+n 或者 Ctrl+p 会有代码提示功能，我们可以实现快速录入的效果。

## 特殊字符

可以使用以下命令，查看可以输入的特殊字符：
```
:digraphs
```

在i模式下，输入Ctrl-k,然后输入下面括号中的内容，可以得到前面的符号  
¬ (NO)  
· (.M)  

在i模式下，输入Ctrl-v,然后输入下面括号中的内容，可以得到前面的符号  
￫ (uffeb)  
↲ (u21b2)  

## VIM的系统剪切板操作
查看是否支持
```
vim --version | grep clipboard
```
如果clipboard前面有加号则代表支持，如果是减号或者没有代表不支持  
把数据从vim拷贝到系统剪切板，需要在visual模式下执行
```
"+y
```
双引号 + 加号寄存器 + y

从系统剪切板拷贝到vim，需要
```
"+p
```
双引号 + 加号寄存器 + p

#### 使用快捷键
"+y和"+p的输入挺麻烦的，为他们创建个快捷键

将下面的内容复制到~/.vimrc中即可生效
```
" 支持在Visual模式下，通过C-y复制到系统剪切板 （vnoremap视觉和选择模式下工作）
vnoremap <C-y> "+y
" 支持在normal模式下，通过C-p粘贴系统剪切板 （nnoremap在正常模式下工作）
nnoremap <C-p> "*p
```
效果就是在vim的visual模式下选中了要复制的内容，再用 Ctrl + y 复制到系统剪切板，直接去其他窗口中 Ctrl + v 粘贴
在其他窗口中选择之后（不一定要Ctrl + c），可直接在vim中用 Ctrl + p 来粘贴

#### 不支持系统剪切板的解决办法
如果出现“-clipboard”则说明系统的vim版本不支持与系统剪贴板的交互操作，需要采用如下的命令安装新的vim
```bash
apt install vim-gtk
```
安装完成之后再利用代码检查一次，出现“+clipboard”，那么系统的vim没有问题。

## vim-tiny的解决办法
大部分默认的 Linux 发行版安装的是精简版(Small version)的 vim，不太好用，但直接安装全功能(Huge version) vim 又弄了两个不同版本的 vim 在系统内，所以最好的办法是把精简版的替换为全功能版的。
```bash
apt remove --assume-yes vim-tiny
apt update
apt install --assume-yes vim
```
安装完成之后再利用代码检查一次，出现“Huge version without GUI”即可

## vim 详细模式
使用“详细模式”来了解 Vim 在做什么。你可以用详细模式启动 Vim：
```bash
cd ~
vim -V9 vimlog.txt
```

这echo说明了 Vim 正在做什么（9表示冗长程度）。

可以使用
```
:messages
```
检查输出，但使用该选项将输出写入文件通常很有用。这是为单个操作执行此操作的示例：

```
:set verbose=9
:set verbosefile=/tmp/output.txt
:verbose {some action}
```

# 更多
* [VIM CHEATSHEET (中文速查表)](https://github.com/skywind3000/awesome-cheatsheets/blob/master/editors/vim.txt)
* [VimScript CHEATSHEET (中文速查表)](https://github.com/skywind3000/awesome-cheatsheets/blob/master/languages/vimscript.md)
* [VIM 中文用户手册](https://yianwillis.github.io/vimcdoc/doc/usr_toc.html)
