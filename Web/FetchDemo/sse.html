<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon"
		href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ²</text></svg>" />
	<title>SSEç¤ºä¾‹</title>
	<link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css">
	<style>
		:root {
			--pico-font-size: 100%;
		}

		.div-result {
			font-size: 14px;
			margin: 1rem auto;
			padding: 1rem;
			color: #5d6baa;
			background: linear-gradient(to right, #f6f8fa, #f6f8fa);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}
	</style>
</head>

<body>
	<main class="container">
		<section id="section1">
			<h2>SSE</h2>
			<p>å•å‡»æŒ‰é’®å°†è¿è¡Œä¸‹é¢çš„å‡½æ•°, åœ¨æµè§ˆå™¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ—¥å¿—</p>
			<button id="sseBtn">SSEè¯·æ±‚</button><br /><br />
			<pre><code>async function () {
	var eventSource = new EventSource('/stream');
	const sseResult = document.getElementById("sseResult");
	sseResult.textContent = "";
	eventSource.onopen = function (event) {
		console.log(`SSEè¿æ¥æˆåŠŸ, çŠ¶æ€:${eventSource.readyState}`);
	};
	eventSource.onerror = function (event) {
		if (eventSource.readyState === EventSource.CLOSED) {
			console.log(`SSEè¿æ¥å…³é—­, çŠ¶æ€:${eventSource.readyState}`);
		} else {
			console.error(`SSEè¿æ¥é”™è¯¯, çŠ¶æ€:${eventSource.readyState}, event:${event}`);
		}
	};
	eventSource.onmessage = function (event) {
		sseResult.textContent += event.data;
	};
	eventSource.addEventListener('close', function (event) {
		console.log(`è‡ªå®šä¹‰äº‹ä»¶closeå·²ç»è¿è¡Œ, å‡†å¤‡å…³é—­SSEè¿æ¥, event.data:${event.data}`);
		eventSource.close();
	}, false);
}</code></pre>
			<div id="sseResult" class="div-result">...ç»“æœå°†åœ¨æ­¤å¤„è¡¨ç¤º...</div>
		</section>
	</main>
	<script>
		const sseRequest = async function () {
			//var eventSource = new EventSource('http://127.0.0.1:9500/stream');
			var eventSource = new EventSource('/stream');
			const sseResult = document.getElementById("sseResult");
			sseResult.textContent = "";
			// è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±ä¼šè§¦å‘openäº‹ä»¶
			eventSource.onopen = function (event) {
				console.log(`SSEè¿æ¥æˆåŠŸ, çŠ¶æ€:${eventSource.readyState}`);
			};
			// å‘ç”Ÿé€šä¿¡é”™è¯¯ï¼ˆæ¯”å¦‚è¿æ¥ä¸­æ–­ï¼‰ï¼Œå°±ä¼šè§¦å‘erroräº‹ä»¶
			eventSource.onerror = function (event) {
				if (eventSource.readyState === EventSource.CLOSED) {
					console.log(`SSEè¿æ¥å…³é—­, çŠ¶æ€:${eventSource.readyState}`);
				} else {
					console.error(`SSEè¿æ¥é”™è¯¯, çŠ¶æ€:${eventSource.readyState}, event:${event}`);
				}
			};
			// å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„æ•°æ®ï¼Œå°±ä¼šè§¦å‘messageäº‹ä»¶
			eventSource.onmessage = function (event) {
				sseResult.textContent += event.data;
			};
			// æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶close
			eventSource.addEventListener('close', function (event) {
				console.log(`è‡ªå®šä¹‰äº‹ä»¶closeå·²ç»è¿è¡Œ, å‡†å¤‡å…³é—­SSEè¿æ¥, event.data:${event.data}`);
				eventSource.close();
			}, false);
		};

		// æŒ‰é’®äº‹ä»¶
		const sseBtn = document.getElementById("sseBtn");
		sseBtn.addEventListener("click", sseRequest);
	</script>
</body>

</html>
