<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon"
		href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤½</text></svg>" />
	<title>ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»ç­‰å¾…json</title>
	<link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css">
	<style>
		:root {
			--pico-font-size: 100%;
		}

		.div-result {
			font-size: 14px;
			margin: 1rem auto;
			padding: 1rem;
			color: #5d6baa;
			background: linear-gradient(to right, #f6f8fa, #f6f8fa);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}
	</style>
</head>

<body>
	<main class="container">
		<section id="section1">
			<h2>ç­‰å¾… HTTPæ¶ˆæ¯å¤´ + HTTPæ¶ˆæ¯ä½“</h2>
			<p>å•å‡»æŒ‰é’®å°†è¿è¡Œä¸‹é¢çš„å‡½æ•°, åœ¨æµè§ˆå™¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ—¥å¿—</p>
			<button id="fetchJsonBtn">FETCH JSON</button><br /><br />
			<pre><code>async function () {
	const fetchResult = document.getElementById("fetchResult");
	fetchResult.textContent = "å¤„ç†ä¸­...";
	console.log("fetchJson HTTPè¯·æ±‚å¼€å§‹");
	let response = await fetch("/json");
	console.log("fetchJson å·²è·å–HTTPå“åº”æ¶ˆæ¯å¤´, ç­‰å¾…HTTPæ¶ˆæ¯ä½“");
	let resultJson = await response.json();
	console.log("fetchJson å·²è·å–HTTPæ¶ˆæ¯ä½“, å°†ç»“æœè½¬æ¢ä¸ºå¯¹è±¡");
	console.log(resultJson);
	fetchResult.textContent = (JSON.stringify(resultJson));
}</code></pre>
			<div id="fetchResult" class="div-result">...ç»“æœå°†åœ¨æ­¤å¤„è¡¨ç¤º...</div>
		</section>
		<hr />
		<section id="section2">
			<h2>ç­‰å¾… HTTPæ¶ˆæ¯å¤´ + åˆ†å—å–å¾—HTTPæ¶ˆæ¯ä½“</h2>
			<p>å•å‡»æŒ‰é’®å°†è¿è¡Œä¸‹é¢çš„å‡½æ•°, åœ¨æµè§ˆå™¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ—¥å¿—</p>
			<button id="streamJsonBtn">STREAM JSON</button><br /><br />
<pre><code>async function () {
	const streamResult = document.getElementById("streamResult");
	streamResult.textContent = "å¤„ç†ä¸­...";
	console.log("fetchStream HTTPè¯·æ±‚å¼€å§‹");
	let response = await fetch("/json");
	console.log("fetchStream å·²è·å–HTTPå“åº”æ¶ˆæ¯å¤´, æµå¼ä¼ è¾“HTTPæ¶ˆæ¯ä½“");
	const decoder = new TextDecoder("utf-8");
	streamResult.textContent = "";
	for await (const value of response.body) {
		const chunk = decoder.decode(value);
		streamResult.textContent += chunk;
	}
	console.log("fetchStream å·²è·å–HTTPæ¶ˆæ¯ä½“");
}</code></pre>
			<div id="streamResult" class="div-result">...ç»“æœå°†åœ¨æ­¤å¤„æµå¼ä¼ è¾“...</div>
		</section>
	</main>
	<script>
		const fetchJson = async function () {
			const fetchResult = document.getElementById("fetchResult");
			fetchResult.textContent = "å¤„ç†ä¸­...";
			console.log("fetchJson HTTPè¯·æ±‚å¼€å§‹");
			let response = await fetch("/json");
			console.log("fetchJson å·²è·å–HTTPå“åº”æ¶ˆæ¯å¤´, ç­‰å¾…HTTPæ¶ˆæ¯ä½“");
			let resultJson = await response.json();
			console.log("fetchJson å·²è·å–HTTPæ¶ˆæ¯ä½“, å°†ç»“æœè½¬æ¢ä¸ºå¯¹è±¡");
			console.log(resultJson);
			fetchResult.textContent = (JSON.stringify(resultJson));
		};

		const fetchStream = async function () {
			const streamResult = document.getElementById("streamResult");
			streamResult.textContent = "å¤„ç†ä¸­...";
			console.log("fetchStream HTTPè¯·æ±‚å¼€å§‹");
			let response = await fetch("/json");
			console.log("fetchStream å·²è·å–HTTPå“åº”æ¶ˆæ¯å¤´, æµå¼ä¼ è¾“HTTPæ¶ˆæ¯ä½“");
			const decoder = new TextDecoder("utf-8");
			streamResult.textContent = "";
			for await (const value of response.body) {
				const chunk = decoder.decode(value);
				streamResult.textContent += chunk;
			}
			console.log("fetchStream å·²è·å–HTTPæ¶ˆæ¯ä½“");
		};
		// æŒ‰é’®äº‹ä»¶
		const fetchJsonBtn = document.getElementById("fetchJsonBtn");
		const streamJsonBtn = document.getElementById("streamJsonBtn");
		fetchJsonBtn.addEventListener("click", fetchJson);
		streamJsonBtn.addEventListener("click", fetchStream)
	</script>
</body>

</html>
