# Python 版本
## 根据需要选择不同版本的 Python 版
FROM python:3.12.4-slim-bookworm

# 创建应用路径
RUN mkdir /opt/app
# 如果需要bash（Alpine默认不带bash）
#RUN apk add --no-cache --upgrade bash

# 构建时变量，仅在构建Docker映像期间可用
# ARG NODE_ENV=production
# 在容器内部设置环境变量
# ENV JAVA_TOOL_OPTIONS="-Duser.language=en -Dfile.encoding=UTF-8"

# 将本地文件复制到镜像中
# 复制src文件夹
COPY src /opt/app/BackendSanic/src
# 复制pyproject.toml文件
COPY pyproject.toml /opt/app/BackendSanic/pyproject.toml

# 安装 Poetry
RUN pip install poetry -i https://pypi.tuna.tsinghua.edu.cn/simple
RUN poetry config virtualenvs.in-project true

# 设置工作目录
WORKDIR /opt/app/BackendSanic

# 安装 Python 依赖
RUN poetry install

# 声明容器运行时监听的特定网络端口
EXPOSE 9501

# 指定容器创建时的默认命令
CMD ["poetry", "run", "python", "src/backendsanic/server.py"]
